<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë‚ ì”¨ ì˜ˆì¸¡ ì‹œìŠ¤í…œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body { font-family: sans-serif; background:#f5f7fa; margin:0; padding:2rem; }
    h1 { text-align:center; color:#333; margin-bottom:1rem; }
    .tabs { display:flex; justify-content:center; gap:1rem; margin-bottom:1rem; flex-wrap:wrap; }
    .tab { padding:0.7rem 1.2rem; background:#ccc; border-radius:5px; cursor:pointer; }
    .tab.active { background:#2d6cdf; color:white; }
    .area { display:none; }
    .area.active { display:block; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:1rem; }
    .card { background:white; border-radius:10px; padding:1rem; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
    .city-header { font-size:1.2rem; margin-bottom:.5rem; text-align:center; color:#444; }
    .forecast-list, .rain-list { list-style:none; padding:0; margin:0; }
    .forecast-item, .rain-item { display:flex; justify-content:space-between; padding:0.5rem 0; border-bottom:1px solid #eee; }
    .btn-refresh { display:block; margin:1rem auto; padding:.8rem 1.2rem; border:none; background:#2d6cdf; color:white; border-radius:5px; cursor:pointer; }
    .btn-refresh:hover { background:#1e50aa; }
    .value { font-weight:bold; }
    .footer {
      text-align:center;
      margin-top:3rem;
      font-size:0.9rem;
      color:#555;
    }
    .footer a {
      color:#2d6cdf;
      text-decoration:none;
    }
  </style>
</head>
<body>

<h1>ëŒ€í•œë¯¼êµ­ ê´‘ì—­ì‹œ ë‚ ì”¨ ì˜ˆë³´ ì‹œìŠ¤í…œ</h1>

<div class="tabs">
  <div class="tab active" data-target="#weatherArea">ğŸŒ¤ï¸ ë‚ ì”¨ ì˜ˆë³´</div>
  <div class="tab" data-target="#rainArea">ğŸŒ§ï¸ ë¹„ ì•ˆ ì˜¬ í™•ë¥ </div>
</div>

<div class="area active" id="weatherArea">
  <button class="btn-refresh" id="refreshWeather">ë‚ ì”¨ ìƒˆë¡œê³ ì¹¨</button>
  <div class="grid" id="weatherGrid"></div>
</div>

<div class="area" id="rainArea">
  <button class="btn-refresh" id="refreshRain">ê°•ìˆ˜ í™•ë¥  ë¶„ì„</button>
  <div class="grid" id="rainGrid"></div>
</div>

<script>
const apiKey = 'pcUzccKB4IaJnGSDzNLNc6uPYvLXgfN/iRo7kkWyjDHqNcUjT9rjdl9Ui9nLZZUN2mNdHFCKrPOr3SpBX3IYAg==';

// íƒ­ ì „í™˜
$('.tab').click(function(){
  $('.tab').removeClass('active');
  $(this).addClass('active');
  $('.area').removeClass('active');
  $($(this).data('target')).addClass('active');
});

// ê´‘ì—­ì‹œ + ì œì£¼ + ê°•ì› ì¢Œí‘œ
const cities = [
  { name: 'ì„œìš¸', nx: 60, ny: 127 },
  { name: 'ë¶€ì‚°', nx: 98, ny: 76 },
  { name: 'ëŒ€êµ¬', nx: 89, ny: 90 },
  { name: 'ì¸ì²œ', nx: 55, ny: 124 },
  { name: 'ê´‘ì£¼', nx: 58, ny: 74 },
  { name: 'ëŒ€ì „', nx: 67, ny: 100 },
  { name: 'ìš¸ì‚°', nx: 102, ny: 84 },
  { name: 'ì œì£¼', nx: 52, ny: 38 },
  { name: 'ê°•ì›', nx: 73, ny: 134 }
];

// ê¸°ì¤€ ë‚ ì§œ ë° ì‹œê°„ ê³„ì‚°
function getBaseDtTm() {
  const now = new Date();
  const y = now.getFullYear();
  const m = ('0' + (now.getMonth() + 1)).slice(-2);
  const d = ('0' + now.getDate()).slice(-2);
  return { base_date: `${y}${m}${d}`, base_time: "0500" };
}

// ë‚ ì”¨ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
function loadCityWeather(city) {
  const dt = getBaseDtTm();
  $.getJSON('https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getVilageFcst', {
    serviceKey: apiKey,
    pageNo: 1,
    numOfRows: 200,
    dataType: 'JSON',
    base_date: dt.base_date,
    base_time: dt.base_time,
    nx: city.nx,
    ny: city.ny
  }, function(res) {
    const items = res.response.body.items.item;
    const today = items.filter(i => i.fcstTime === '1200');
    let sky = '-', tmp = '-';
    today.forEach(i => {
      if (i.category === 'SKY') sky = i.fcstValue;
      if (i.category === 'TMP') tmp = i.fcstValue;
    });
    const skyMap = { '1': 'â˜€ï¸ ë§‘ìŒ', '3': 'â›… êµ¬ë¦„ë§ìŒ', '4': 'â˜ï¸ íë¦¼' };
    const html = `
      <div class="city-header">${city.name}</div>
      <ul class="forecast-list">
        <li class="forecast-item"><span>í•˜ëŠ˜ ìƒíƒœ</span><span>${skyMap[sky] || '-'}</span></li>
        <li class="forecast-item"><span>ê¸°ì˜¨</span><span>${tmp}Â°C</span></li>
      </ul>`;
    $(`#w-${city.name}`).html(html);
  });
}

// ë¹„ ì•ˆ ì˜¤ëŠ” ê¸°ê°„ ì˜ˆì¸¡ (ê¸°í•˜ë¶„í¬)
function loadRainPrediction(city) {
  const dt = getBaseDtTm();
  $.getJSON('https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getVilageFcst', {
    serviceKey: 'pcUzccKB4IaJnGSDzNLNc6uPYvLXgfN/iRo7kkWyjDHqNcUjT9rjdl9Ui9nLZZUN2mNdHFCKrPOr3SpBX3IYAg==',
    pageNo: 1,
    numOfRows: 200,
    dataType: 'JSON',
    base_date: dt.base_date,
    base_time: dt.base_time,
    nx: city.nx,
    ny: city.ny
  }, function(res) {
    const items = res.response.body.items.item;
    const popItem = items.find(i => i.fcstTime === '1200' && i.category === 'POP');
    const rainProb = popItem ? parseFloat(popItem.fcstValue) : null;
    let result = 'ì •ë³´ ì—†ìŒ';
    if (rainProb !== null) {
      const p = rainProb / 100;
      const expectedDays = p > 0 ? (1 / p).toFixed(1) : "âˆ";
      result = `<ul class="rain-list">
                  <li class="rain-item"><span>ê°•ìˆ˜í™•ë¥ </span><span>${rainProb}%</span></li>
                  <li class="rain-item"><span>ë¹„ ì•ˆ ì˜¬ ì˜ˆìƒì¼ìˆ˜</span><span>${expectedDays}ì¼</span></li>
                </ul>`;
    }
    $(`#r-${city.name}`).html(`<div class="city-header">${city.name}</div>${result}`);
  });
}

// ë‚ ì”¨ ì„¹ì…˜ ë¡œë”©
function refreshWeather() {
  $('#weatherGrid').empty();
  cities.forEach(city => {
    $('#weatherGrid').append(`<div class="card" id="w-${city.name}">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>`);
    loadCityWeather(city);
  });
}

// ë¹„ ì˜ˆì¸¡ ì„¹ì…˜ ë¡œë”©
function refreshRain() {
  $('#rainGrid').empty();
  cities.forEach(city => {
    $('#rainGrid').append(`<div class="card" id="r-${city.name}">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>`);
    loadRainPrediction(city);
  });
}

// ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
$('#refreshWeather').on('click', refreshWeather);
$('#refreshRain').on('click', refreshRain);

// ìµœì´ˆ ì‹¤í–‰
refreshWeather();
refreshRain();
</script>

<!-- í•˜ë‹¨ ì¤‘ì•™ ê¸°ìƒì²­ ë§í¬ -->
<div class="footer">
  ğŸ“¡ ë°ì´í„° ì¶œì²˜: 
  <a href="https://www.kma.go.kr" target="_blank">ëŒ€í•œë¯¼êµ­ ê¸°ìƒì²­ (KMA)</a>
</div>

</body>
</html>